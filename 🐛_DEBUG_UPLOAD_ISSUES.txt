â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ› DEBUG: File Upload Issues
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Status: Error logging added
Date: 2025-10-08

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… WHAT I FIXED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. âœ… Added error handling to upload middleware
2. âœ… Added detailed logging to upload route
3. âœ… Improved error messages
4. âœ… Better destination path handling

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” HOW TO DEBUG THE UPLOAD ERROR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Step 1: Start the app
--------------------
npm run dev

Step 2: Open browser
-------------------
Go to: http://localhost:5173

Step 3: Open DevTools
---------------------
Press F12 to open browser console

Step 4: Try uploading
--------------------
1. Click "Create Session"
2. Select files to upload
3. Click "Upload Files"
4. Watch BOTH:
   - Browser console (F12)
   - Terminal where backend is running

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ WHAT TO CHECK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

In Browser Console (F12 â†’ Console):
-----------------------------------
Look for errors like:
âŒ Failed to fetch
âŒ Network error
âŒ 404 Not Found
âŒ 500 Internal Server Error

In Backend Terminal:
-------------------
Look for these messages:
[UPLOAD] Attempting to upload files for session: xxxxxx
[UPLOAD] Session found. Files received: X
[UPLOAD] Adding files to session...
[UPLOAD] Success! X files uploaded

Or error messages:
âŒ [UPLOAD] Session not found
âŒ [UPLOAD] No files in request
âŒ [UPLOAD] Error uploading files: ...
âŒ Error setting upload destination
âŒ Error generating filename

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ COMMON ISSUES & FIXES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Issue 1: "Session not found"
---------------------------
Problem: Session creation failed or expired
Fix: 
  1. Check if "Create Session" button works
  2. Verify session code appears
  3. Try uploading immediately after creating

Issue 2: "No files in request"
-----------------------------
Problem: Files not being sent from frontend
Fix:
  1. Check file size (max 20MB per file)
  2. Check file type (JPEG, PNG, WebP only)
  3. Check browser console for errors

Issue 3: "ENOENT" or "Permission denied"
---------------------------------------
Problem: Storage directory issues
Fix:
  1. Check if storage/ folder exists
  2. Run as administrator if needed
  3. Check folder permissions

Issue 4: Backend not running
---------------------------
Problem: npm run dev didn't start properly
Fix:
  1. Kill any existing node processes
  2. Run: npm run dev
  3. Wait for "Server running" message

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ§ª MANUAL TEST STEPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Start the app:
   npm run dev

2. Wait for both to start:
   âœ“ Backend: http://localhost:3000
   âœ“ Frontend: http://localhost:5173

3. Test backend directly:
   Open: http://localhost:3000/api/health
   Should see: {"status":"ok","timestamp":"..."}

4. Test session creation:
   Open browser console (F12)
   Go to: http://localhost:5173
   Click: "Create Session"
   Should see: 6-character code

5. Test file upload:
   - Select a small image (< 5MB)
   - Must be JPEG, PNG, or WebP
   - Click "Upload Files"
   - Watch backend terminal for logs

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ ERROR MESSAGES EXPLAINED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

"Failed to upload files"
â†’ Generic error from frontend
â†’ Check backend terminal for real error

"Session not found or expired"
â†’ Session code is invalid or old
â†’ Create a new session

"No files uploaded"
â†’ Files not received by backend
â†’ Check file size and type

"File too large"
â†’ File exceeds 20MB limit
â†’ Use smaller files

"Only JPEG, PNG, and WebP images are allowed"
â†’ Wrong file type
â†’ Use image files only

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ QUICK FIX COMMANDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Kill all Node processes:
Get-Process -Name node | Stop-Process -Force

Check if port 3000 is in use:
Get-NetTCPConnection -LocalPort 3000 -ErrorAction SilentlyContinue

Check storage folder:
Test-Path "storage"
Get-ChildItem "storage"

Delete storage and recreate:
Remove-Item "storage" -Recurse -Force
New-Item -ItemType Directory -Path "storage"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š EXPECTED LOG OUTPUT (Good)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Backend Terminal:
[UPLOAD] Attempting to upload files for session: abc123
[UPLOAD] Session found. Files received: 1
[UPLOAD] Adding files to session...
[UPLOAD] Success! 1 files uploaded

Browser Console:
POST /api/sessions/abc123/files 200 OK
Response: {message: "Files uploaded successfully", ...}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âŒ EXAMPLE ERROR LOGS (Bad)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Backend Terminal:
[UPLOAD] Error uploading files: Error: ENOENT: no such file or directory
â†’ Storage folder issue

[UPLOAD] Session not found: abc123
â†’ Session expired or invalid

Browser Console:
POST /api/sessions/abc123/files 404 Not Found
â†’ Session doesn't exist

POST /api/sessions/abc123/files net::ERR_CONNECTION_REFUSED
â†’ Backend not running

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ NEXT STEPS IF STILL FAILING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Copy the EXACT error message from:
   - Browser console (F12)
   - Backend terminal

2. Check these files exist:
   â–¡ api/routes/sessions.js
   â–¡ api/middleware/upload.js
   â–¡ api/utils/storage.js
   â–¡ storage/ folder

3. Try uploading a very small image (< 1MB)

4. Try with a different browser

5. Restart the entire app:
   - Close all terminals
   - Run: npm run dev
   - Try again

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… STATUS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Error logging added
âœ“ Upload middleware improved
âœ“ Debugging enabled
âœ“ Ready for testing

App should be running now!
Check terminal for errors.
